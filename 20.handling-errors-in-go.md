## [处理 Go 中的错误](https://www.digitalocean.com/community/tutorials/handling-errors-in-go)

由 **Gopher Guides** 编写，[@JialeDai](https://github.com/daijiale) 译

>健壮的代码往往需要能应对更多意外的异常场景。例如，用户输入异常、网络连接异常、磁盘故障等。错误处理是能自动识别程序何时何地处于何种异常状态，并根据状态分批记录诊断信息，供之后调试的过程。与那些需要研发人员使用特殊语法糖来处理异常信息的语言不同，Go中的异常错误信息是通过从函数返回的`error`类型来定义区分，处理逻辑与其他类型的函数返回值一样。要处理Go中的异常错误，我们必须提前定义函数可以返回这些异常错误类型来确定程序是否在执行过程中抛出了异常，同时，采取适当的措施来保护程序数据并通知用户/操作员这个异常事件已发生。

### 创建错误

在我们处理错误信息之前，我们需要先创建一些。Go标准库提供了两个内置函数来创建错误信息：`errors.New` 和 `fmt.Errorf`。这两个方法都允许你自定义面向用户侧所展示的错误信息。 `errors.New` 只接受一个传入参数：字符串类型的错误信息。你可以通过自定义这个参数来提示用户这个错误的具体内容。我们尝试通过运行下文的例子来看一看一个由`errors.New` 所产生的错误信息：

```go
package main

import ( 
    "errors"
    "fmt"
)

func main() {
    err := errors.New("barnacles") 
    fmt.Println("Sammy says:", err)
}
```

输出为：

```
Sammy says: barnacles
```


我们使用标准库中的 `errors.New` 方法来创建新的错误，并以字符串类型的'barnacles'作为错误内容的描述。依照[Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments#error-strings)标准，我们常常使用小写字母来命名错误内容描述。

最终，我们使用`fmt.Println`方法来组合 'Sammy says: '信息，并打印出来。

使用 `fmt.Errorf`方法可以动态的生成错误信息。它的第一个传参是可带占位符的动态变量：`%s`标识字符串，`%d`标识整数。 `fmt.Errorf`将该格式字符串后面的参数按顺序插入到这些占位符变量之中：

```go
package main

import (
    "fmt"
    "time"
)

func main() {
    err := fmt.Errorf("error occurred at: %v", time.Now())
    fmt.Println("An error happened:", err)
}

```

输出为：

```
An error happened: Error occurred at: 2019-07-11 16:52:42.532621 -0400 EDT m=+0.000137103
```

我们使用了`fmt.Errorf`方法来构建一条包含当前时间的错误信息。我们在`fmt.Errorf`所传字符串参数中指定了 `%v`占位符变量来承接标准库中`time.Now`函数返回的当前时间实际值。与前面的示例类似，我们将错误内容与一个错误前缀组合在一起，并使用`fmt.Println`打印而出。


### 处理错误